<!doctype html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>注册</title>
    <link rel="stylesheet" href="./__GROUP__/css/validationEngine.jquery.css" type="text/css" />
    <include file="./Tpl/bootstrap/public/static.html" />
    <style type="text/css">
    #email-goto {
        top: 13px;
    }
    
    #email {
        border-radius: 4px;
    }
    
    #select-list a {
        cursor: pointer;
    }
    
    .red {
        color: #F00;
    }
    
    .my-warning {
        float: left;
    }
    
    #verify>img,
    #verify>button {}
    </style>
    <script>
    </script>
</head>

<body>
    <include file="./Tpl/bootstrap/public/header.html" />
    <!--container-->
    <div class="container">
        <div class="page-header">
            <h1>注册<small>小蜜蜂兼职</small></h1>
        </div>
        <div class="row">
            <div class="col-md-7">
                <div class="alert alert-success hidden" role="alert">
                    <button type="button" class="close" aria-hidden="true">&times;</button>
                    <p>注册成功,等待跳转...</p>
                </div>
                <ul class="nav nav-pills" id="select-list">
                    <li role="presentation" class="active"><a>求职者</a></li>
                    <li role="presentation"><a>公司或机构组织</a></li>
                </ul>
                <form method="post" action="{:U('Register/reg')}" id="reg-form">
                    <div class="form-group input-group">
                        <label for="email">邮箱：</label>
                        <input id="email" type="text" name="email" class="form-control" disabled="true" placeholder="" value="{$email}" />
                    </div>
                    <div class="form-group">
                        <label for="passwd">密码：</label>
                        <input id="passwd" type="password" name="passwd" class="form-control validate[required] text-input" data-prompt-position="topRight:-70" placeholder="请输入密码" />
                    </div>
                    <div class="form-group">
                        <label for="passwd">确认密码：</label>
                        <input id="repasswd" type="password" name="repasswd" class="form-control validate[required,equals[passwd]] text-input" data-prompt-position="topRight:-70" placeholder="再次输入密码" />
                    </div>
                    <div class="form-group clearfix" id="verify">
                        <div class="rows">
                            <div class="col-md-8" style="padding-left:0">
                                <input class="form-control" type="text" name="vcode" placeholder="验证码" />
                            </div>
                            <div class="col-md-4">
                                <img src="{:U("Register/vCode")}" class="verify" />
                                <button type="button" class="btn btn-default verify">刷新</button>
                            </div>
                        </div>
                    </div>
					<div class="form-group">
                    	<input type="checkbox" name="" class="" id="our-article" /><label for="our-article">同意我们的条款</label>（<a href="{:U("Register/ourArticle")}" target="_blank">查看</a>）
                    </div>
                    <button type="button" class="btn btn-default" id="reg-goto">提交</button>
                </form>
            </div>
            <div class="col-md-1"></div>
            <div class="col-md-4">
                <div class="panel panel-default">
                    <div class="panel-heading">关于小蜜蜂</div>
                    <div class="panel-body">
                        <img src="/__GROUP__/images/erweima.png" class="img-thumbnail center-block" />
                    </div>
                </div>
            </div>
        </div>
        <!--end container-->
        <!--footer-->
        <div class="container">
            <hr />
            <p class="text-center">小蜜蜂兼职</p>
            <p class="my-info text-center"><a href="#">首页</a>/<a href="#">申请入住</a>/<a href="#">关于小蜜蜂</a>/<a href="#">联系我们</a></p>
            <p class="copyright text-center">Copyright ©小蜜蜂网络 / 备案号：ICP备13008243号-1 / 地址：烟台市红旗中路</p>
        </div>
        <!--end footer-->
        <script type="text/javascript">
        function tabShow(arg) {
            for (var i = 0; i < 2; i++) {
                $("#select-list>li").eq(i).removeClass("active");
            }

            $("#select-list>li").eq(arg).addClass("active");
            whatToSelect = arg;
        }


        function tabChange(arg) {
                var str = new String('<div class="form-group input-org"><label for="org">组织名称：</label><input id="org" type="text" name="org" class="form-control" placeholder="组织机构学校名称" /></div><div class="form-group input-org"><label for="org_address">所在地：</label><input id="org_address" type="text" name="org_address" class="form-control" placeholder="组织机构学校所在地" /></div>');
                if (arg == 0) {
                    console.log(0)
                    if ($(".input-org")) {
                        $(".input-org").remove();
                    }
                } else {
                    if ($(".input-org").length != 0) {} else {
                        $("#reg-goto").before(str);
                    }
                }
            }
            //绑定事件
        $("#select-list>li").eq(0).click(function() {
            tabShow(0);
            tabChange(0);
        });
        $("#select-list>li").eq(1).click(function() {
            tabShow(1);
            tabChange(1);
        });
        (function(){
        	$(".alert button").on('click',function(){
        		$(this).parent().addClass("hidden");
        	});
        })();
        //Ajax	
        $("#reg-goto").click(function() {
            //获取数据
            var info = getFromInput("#reg-form");
            //验证两次密码
            if (info.passwd === '') {
                $(".alert>p").text("您忘记填写密码啦");
                $(".alert").removeClass("alert-success").addClass("alert-danger");
                $(".alert").removeClass("hidden");
                return;
            }
            if (info.passwd != info.repasswd) {
                $(".alert").removeClass("alert-success").addClass("alert-danger");
                $(".alert>p").text("两次密码不一致");
                $(".alert").removeClass("hidden");
                return;
            }
            if(info.org === ''){
            	$(".alert>p").text("企业用户须填写企业名称");
                $(".alert").removeClass("alert-success").addClass("alert-danger");
                $(".alert").removeClass("hidden");
                return;
            }
            if(info.org_address === ''){
            	$(".alert>p").text("企业用户须填写企业所在地");
                $(".alert").removeClass("alert-success").addClass("alert-danger");
                $(".alert").removeClass("hidden");
                return;
            }
            //验证是否勾选用户条款
            	var flagChecked = document.getElementById("our-article").checked;
	            if( !flagChecked ){
	            	$(".alert>p").text("您需要同意我们的协议，才能注册");
	                $(".alert").removeClass("alert-success").addClass("alert-danger");
	                $(".alert").removeClass("hidden");
	            	return;
	            }
            //ajax传输
            $.post(
                "{:U('Register/reg')}",
                info,
                function(data) {
                	$(".alert").removeClass("alert-danger").addClass("alert-success");
                    $(".alert>p").text(data.info);
                    if (data.data == 0) {
                        setTimeout(function() {
                            location.href = '{:U("Login/index")}';
                        }, 3000);

                    } else {
                    	$(".alert").removeClass("alert-success").addClass("alert-danger");
                        setTimeout(function() {
                            $("#verify>img").click()
                        }, 500);
                    }

                    $(".alert").removeClass("hidden");

                }
            );
        });
        //表单验证
        </script>
</body>
