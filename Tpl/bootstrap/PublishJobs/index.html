<!doctype html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>兼职平台</title>
    <include file="./Tpl/bootstrap/public/static.html" />
    <link href="/__GROUP__/css/bootstrap-datetimepicker.min.css" rel="stylesheet" media="screen">
    <script type="text/javascript" src="/__GROUP__/js/bootstrap-datetimepicker.min.js" charset="UTF-8"></script>
    <script type="text/javascript" src="/__GROUP__/js/bootstrap-datetimepicker.zh-CN.js" charset="UTF-8"></script>
    <script type="text/javascript" src="http://webapi.amap.com/maps?v=1.3&key=8d8574dfcfd097659736c026a6921ca5"></script>
    <style type="text/css">
    .panel-body {
        position: relative;
    }
    
    .my-perinfo {
        margin-left: 26px;
    }
    
    .my-perinfo>p>span {
        margin-right: 18px;
    }
    
    .my-perimg {
        border: 1px solid #EEE;
    }
    
    .my-select-address {}
    
    .my-select-address>select {
        width: auto;
        display: inline-block;
    }
    
    .my-personimg {
        width: 200px;
        cursor: pointer;
    }
    
    #swfwrapper {
        width: 630px;
    }
    
    div.expire {
        font: 18px/34px "";
        height: 34px;
    }
    
    .form-group div.form_datetime {
        padding-left: 15px;
    }
    #mapContainer{
      height:500px;
    }
    </style>
</head>

<body>
    <include file="./Tpl/bootstrap/public/header.html" />
    <!--container-->
    <div class="container">
        <div class="row">
            <div class="page-header">
                <h1><small>发布新兼职</small></h1>
            </div>
            <div class="col-md-7">
                <div class="alert alert-success hidden" role="alert">
                    <button type="button" class="close" aria-hidden="true">&times;</button>
                    <p>不符合</p>
                </div>
                <form id="jobinfo" class="form-horizontal clearfix">
                    <div class="form-group">
                        <label for="job-name" class="col-sm-2 control-label">兼职标题：</label>
                        <div class="col-sm-10">
                            <input class="form-control" name="title" placeholder="兼职标题" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="style" class="col-sm-2 control-label">工作类型:</label>
                        <div class="col-sm-10">
                            <select name="style" class="form-control">
                                <option value="">请选择...</option>
                                <volist name="molds" id="molds">
                                    <option value="{$molds.mid}">{$molds.name}</option>
                                </volist>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="job-consumer" class="col-sm-2 control-label">联系人：</label>
                        <div class="col-sm-10">
                            <input class="form-control" name="leader" placeholder="联系人" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="jobn-tel" class="col-sm-2 control-label">联系电话：</label>
                        <div class="col-sm-10">
                            <input class="form-control" name="phone" placeholder="联系电话" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="job-people" class="col-sm-2 control-label">需求人数：</label>
                        <div class="col-sm-4">
                            <input name="want_peo" class="form-control" placeholder="人数" />
                        </div>
                        <div class="col-sm-6">
                            <select name="p_s" id="" class="form-control">
                                <option value="">请选择类型...</option>
                                <option value="1">人数是精确的</option>
                                <option value="2">人数是在范围内的</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="job-address" class="col-sm-2 control-label">工作地点：</label>
                        <div class="col-sm-10">
                            <input type="text" id="address" class="hidden" name="address" />
                            <input class="form-control" id="addressname" name="addressname" placeholder="工作地点" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="job-much" class="col-sm-2 control-label">工资范围：</label>
                        <div class="col-sm-4">
                            <input name="money" class="form-control" placeholder="工资（数字）" />
                        </div>
                        <div class="col-sm-6">
                            <select name="m_s" class="form-control">
                                <option value="">请选择结算方式...</option>
                                <option value="1">每小时</option>
                                <option value="2">每天</option>
                                <option value="3">每次</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2">付款方式：</label>
                        <div class="col-sm-10">
                            <select name="py" class="form-control">
                                <option value="">请选择</option>
                                <option value="1">支付宝</option>
                                <option value="2">银行卡</option>
                                <option value="3">现金</option>
                            </select>
                        </div>

                    </div>
                    <div class="form-group">
                        <label for="" class="col-sm-2 control-label">到岗时间：</label>
                        <div class="col-sm-10 input-group date form_datetime" id="begin_time">
                            <input name="begin_time" type="text" class="form-control" readonly="true" placeholder="到岗时间" />
                            <span class="input-group-addon"><span class="glyphicon glyphicon-th"></span></span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="" class="col-sm-2 control-label">工作时长：</label>
                        <div class="col-sm-10">
                            <select name="wt" class="form-control">
                                <option value="">请选择...</option>
                                <option value="1">1小时</option>
                                <option value="2">2小时</option>
                                <option value="3">3小时</option>
                                <option value="4">4小时</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="job-expire" class="col-sm-2 control-label">过期时间：</label>
                        <div class="row">
                            <div class="col-md-4">
                                <select name="expire_time" class="form-control">
                                    <option value="">请选择...</option>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                    <option value="6">6</option>
                                    <option value="7">7</option>
                                    <option value="8">长期</option>
                                </select>
                            </div>
                            <div class="col-md-4 expire">天后过期</div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="" class="col-sm-2 control-label">工作介绍：</label>
                        <div class="col-sm-10">
                            <textarea class="form-control" rows="3" name="detail" placeholder="工作介绍"></textarea>
                        </div>
                    </div>
                    <button type="button" class="btn btn-primary pull-right" id="publish">提交</button>
                </form>
            </div>
            <div class="col-md-1"></div>
            <div class="col-md-4">
                <div class="panel panel-default">
                    <div class="panel-heading">关于小蜜蜂</div>
                    <div class="panel-body">
                        <img src="/__GROUP__/images/erweima.png" class="img-thumbnail center-block" />
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--modeal-->
    <div class="modal fade">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">选择地点</h4>
                </div>
                <div class="modal-body">
                    <div id="tip">
                        省：<select id='province' style="width:100px"  onchange='search(this)'></select>
                        市：<select id='city' style="width:100px"  onchange='search(this)'></select>
                        区：<select id='district' style="width:100px" onchange='search(this)'></select>
                        商圈：<select id='biz_area' style="width:100px"></select>
                    </div>
                    <div id="mapContainer"></div>
                    
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">确认</button>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>
    <!-- /.modal -->

    <!--./container-->
    <!--footer-->
    <include file="./Tpl/bootstrap/public/footer.html" />
    <!--./footer-->
    <script>
        var allowAddress = new Array('烟台市','青岛');
    </script>
    <script type="text/javascript" src="/__GROUP__/js/map.js"></script>
    <script type="text/javascript">
    //Modal
    $("#addressname").on('focus',function(){
      $(".modal").modal('show');
    });
    $('.modal').on('hidden.bs.modal', function (e) {
        if(addressname){
            $("#address").val(address.x + "," +address.y);
            $("#addressname").val(addressname);  
        }
    })
    
    //时间控件
    $("#begin_time").datetimepicker({
        format: 'yyyy-mm-dd hh:ii',
        autoclose: true
    });
    $("#publish").click(function() {
        //获取数据
        var info = getFromInput("#jobinfo");
        info['detail'] = $("textarea[name='detail']").val();
        if(address.x && address.y){
          info.address = address.x + "," +address.y;
        }else if($("#address").val()){
          info.address = $("#address").val();
        }else{
          address = '';
        }
        info.addresscity = addresscity;
        console.log(info);
        //ajax
        $.ajax({
            url: "{:U('PublishJobs/publish')}",
            data: info,
            type: "POST",
            success: function(data) {
                if (data.data === 0) {
                    $(".alert>p").text(data.info);
                    $(".alert").removeClass("alert-danger").addClass("alert-success");
                    $(".alert").removeClass("hidden");
                    var url = "{:U('PublishJobs/index')}";
                    setTimeout(function() {
                        location.href = url;
                    }, 3000)

                } else {
                    $(".alert>p").text(data.info);
                    $(".alert").removeClass("alert-success").addClass("alert-danger");
                    $(".alert").removeClass("hidden");
                }
            },
            error: function() {
                $(".alert>p").text("发布失败，请检查网络状况是否良好，稍后再试");
                $(".alert").removeClass("alert-success").addClass("alert-danger");
                $(".alert").removeClass("hidden");
            }
        });
    });
    </script>
</body>

</html>
