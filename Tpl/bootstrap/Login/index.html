<!doctype html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>登录</title>
    <include file="./Tpl/bootstrap/public/static.html" />
    <style type="text/css">
    .red {
        color: #F00;
    }
    
    .panel-body,.panel{
        position: relative;
    }
    
    #verify>input {
        display: inline;
        width: 216px;
    }
    
    .alert-sm {
        padding: 10px;
    }
    </style>
</head>

<body>
    <include file="./Tpl/bootstrap/public/header.html" />
    <div class="container">
        <div class="row">
            <div class="col-md-8"></div>
            <div class="col-md-4">
                <div class="panel panel-default">
                    <div class="panel-heading">登录</div>
                    <div class="panel-body">
                        <form id="login-form">
                          <div class="alert alert-success alert-sm hidden" role="alert">
                              <button type="button" class="close" aria-hidden="true">&times;</button>
                              <p></p>
                          </div>
                          <div class="btn-group" data-toggle="buttons">
                              <label class="btn btn-primary">
                                <input type="radio" name="options" id="option2" autocomplete="off"> Radio 2
                              </label>
                              <label class="btn btn-primary">
                                <input type="radio" name="options" id="option3" autocomplete="off"> Radio 3
                              </label>
                            </div>
                            <div class="form-group">
                                <input type="text" id="email" name="email" class="form-control" placeholder="登录邮箱" />
                            </div>
                            <div class="form-group">
                                <input type="password" id="passwd" class="form-control" placeholder="密码" />
                            </div>
                            <div class="form-group" id="verify">
                                <img src="{:U('Login/vCode')}" class="verify" />
                                <input type="text" class="form-control" placeholder="验证码" />
                                <button class="btn btn-default verify" type="button">刷新</button>
                            </div>
                                  <div class="checkbox">
                                    <label>
                                      <input type="checkbox" id="pwdmem" value="1">三天内免登录
                                    </label>
                                  </div>
                            <div class="form-group">
                                <button type="button" class="btn btn-default pull-right" id="login">登录</button>
                            </div>
                        </form>
                    </div>
                    <div class="panel-footer">xiaomifengjob.com</div>
                </div>
            </div>
        </div>
    </div>
    <!--./container-->
    <!--footer-->
    <include file="./Tpl/bootstrap/public/footer.html" />
    <!--./footer-->
    <script>
    (function() {
        $(".alert button").on('click', function() {
            $(this).parent().addClass("hidden");
        });
    })();
    //按钮点击时触发ajax
    $("#login").click(function() {
        //获取字段值
        var email = $("#email").val();
        var passwd = $("#passwd").val();
        var ver_val = $("#verify>input").val();
        //checkbox判断
        var pwdmem = $("#pwdmem").is(":checked");
        pwdmem = pwdmem ? 1 : 0;
        //检测字段是否为空
        if (email == "") {
            $("#email").focus();
            $(".alert>p").text("您忘记填写邮箱啦"); $(".alert").removeClass("alert-success").addClass("alert-danger"); $(".alert").removeClass("hidden");

            return;
        }
        if (passwd == "") {
            $("#passwd").focus();
            $(".alert>p").text("您忘记填写密码啦"); $(".alert").removeClass("alert-success").addClass("alert-danger"); $(".alert").removeClass("hidden");
            return;
        }
        //AJAX
        $.post(
            "{:U('Login/login')}",
            {
                email: email,
                passwd: passwd,
                pwdmem: pwdmem,
                verify: ver_val
            },
            function(data) {
              var org = "{:U("OrgCenter/index")}",user = "{:U("UserCenter/index")}";
              if(data.data == 0){
                $(".alert").removeClass("alert-danger").addClass("alert-success");
                if(data.status == 0){
                  setTimeout(function(){location.href = user},1000);
                }else if(data.status == 1){
                  setTimeout(function(){location.href = org},1000);
                }
              }else{
                setTimeout(function() {
                            $("#verify>img").click()
                        }, 500);
                $(".alert").removeClass("alert-success").addClass("alert-danger");
              }
              $(".alert>p").text(data.info);
              $(".alert").removeClass("hidden");
            }
        );
    });
enterKey($("#verify input"),$("#login"));
    </script>
</body>

</html>
